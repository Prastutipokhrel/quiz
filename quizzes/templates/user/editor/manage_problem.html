{% extends 'base.html' %}

{% block title %}
Manage Problem
{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2>Manage Problem</h2>
    <form method="post" enctype="multipart/form-data" id="problem-form">
        {% csrf_token %}
        <div class="form-group">
            <label for="question_text">Question Text</label>
            {{ form.question_text }}
        </div>
        <div class="form-group">
            <label for="correct_answer">Correct Answer</label>
            {{ form.correct_answer }}
        </div>
        <div class="form-group">
            <label for="subcategory">Subcategory</label>
            {{ form.subcategory }}
        </div>
        <div class="form-group">
            <label for="math_text">Math Text</label>
            <div id="editor-container"></div>
            {{ form.math_text }}
        </div>
        <button type="submit" class="btn btn-primary" name="action" value="done">Save and Done</button>
        <button type="submit" class="btn btn-secondary" name="action" value="add_another">Save and Add Another</button>
    </form>
</div>

<!-- KaTeX CSS and JS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.js"></script>

<!-- Quill editor CSS and JS -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

<script>
    // Initialize Quill editor
    var quill = new Quill('#editor-container', {
        theme: 'snow',
        modules: {
            toolbar: [
                [{ 'font': [] }, { 'size': [] }],
                [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
                ['bold', 'italic', 'underline', 'strike'],
                [{ 'color': [] }, { 'background': [] }],
                [{ 'script': 'sub' }, { 'script': 'super' }],
                ['blockquote', 'code-block'],
                [{ 'list': 'ordered' }, { 'list': 'bullet' }, { 'indent': '-1' }, { 'indent': '+1' }],
                ['direction', { 'align': [] }],
                ['link', 'image', 'video', 'formula'],
                ['clean']
            ],
            formula: true
        }
    });

    // Populate Quill editor with existing data if any
    document.addEventListener("DOMContentLoaded", function() {
        const mathText = document.querySelector('input[name="math_text"]').value;
        quill.root.innerHTML = mathText;
    });

    // Update hidden input with Quill editor content on form submit
    document.querySelector('#problem-form').onsubmit = function() {
        document.querySelector('input[name="math_text"]').value = quill.root.innerHTML;
    };
</script>
{% endblock %}

